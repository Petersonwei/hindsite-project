<div class="section">
  <div class="flex justify-between items-center mb-6">
    <h1 class="section-title">Users</h1>
    <% if logged_in? %>
      <%= link_to "New User", new_user_path, class: "btn btn-primary" %>
    <% end %>
  </div>
  
  <div class="grid sm:grid-cols-2 gap-4">
    <% @users.each do |user| %>
      <div class="card">
        <div class="card-content">
          <h2 class="card-title mb-4"><%= user.name %></h2>
          <div class="grid gap-2">
            <div class="flex">
              <div class="font-medium w-28">Email:</div>
              <div class="text-foreground"><%= user.email %></div>
            </div>
            <div class="flex">
              <div class="font-medium w-28">Status:</div>
              <div>
                <% if user.active? %>
                  <span class="badge badge-primary">Active</span>
                <% else %>
                  <span class="badge badge-secondary">Departed</span>
                <% end %>
              </div>
            </div>
            <div class="flex">
              <div class="font-medium w-28">Organisation:</div>
              <div class="text-foreground">
                <% if user.organisation %>
                  <%= user.organisation.name %>
                <% else %>
                  <span class="text-muted-foreground italic">Not a member of any organisation</span>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-footer">
          <div class="flex justify-between items-center w-full">
            <% if current_user && current_user == user %>
              <span class="text-primary font-medium">This is you</span>
            <% else %>
              <span></span>
            <% end %>
            
            <div class="flex gap-2">
              <%= link_to "View Profile", user, class: "btn btn-ghost btn-sm" %>
              <% if current_user && current_user == user %>
                <%= link_to "Edit Profile", edit_user_path(user), class: "btn btn-primary btn-sm" %>
              <% elsif current_user && current_user.organisation.present? && current_user.organisation == user.organisation %>
                <% if user.active? %>
                  <%= link_to "Mark as Departed", depart_user_path(user), class: "btn btn-outline btn-sm", 
                            data: { turbo_method: :patch, turbo_confirm: "Are you sure you want to mark this user as departed?" } %>
                <% else %>
                  <%= link_to "Reactivate", reactivate_user_path(user), class: "btn btn-secondary btn-sm", 
                            data: { turbo_method: :patch, turbo_confirm: "Are you sure you want to reactivate this user?" } %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
