<div class="section">
  <div class="flex justify-between items-center mb-6">
    <h1 class="section-title">Posts</h1>
    <div class="flex gap-2">
      <% if logged_in? && current_user.organisation.present? %>
        <%= link_to "View Departed Employee Posts", departed_posts_path, class: "btn btn-outline" %>
      <% end %>
      <% if logged_in? %>
        <%= link_to "New Post", new_post_path, class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
  
  <% if @no_organisation %>
    <div class="alert alert-warning mb-6">
      <p>You are not currently a member of any organisation. Join an organisation to see posts from other members.</p>
      <div class="mt-4">
        <%= link_to "View Available Organisations", organisations_path, class: "btn btn-secondary" %>
      </div>
    </div>
  <% end %>

  <% if current_user.organisation.present? %>
    <div class="card mb-6">
      <div class="card-content">
        <%= form_with url: posts_path, method: :get, class: "flex flex-col md:flex-row gap-4 items-end" do |form| %>
          <div class="form-group m-0">
            <%= form.label :user_id, "Filter by Employee:", class: "form-label" %>
            <%= form.select :user_id, 
                options_for_select([["All Employees", ""]] + @users.map { |u| [u.name, u.id] }, params[:user_id]), 
                {}, { class: "input" } %>
          </div>
          
          <div class="form-group m-0">
            <%= form.label :start_date, "From:", class: "form-label" %>
            <%= form.date_field :start_date, value: params[:start_date], class: "input" %>
          </div>
          
          <div class="form-group m-0">
            <%= form.label :end_date, "To:", class: "form-label" %>
            <%= form.date_field :end_date, value: params[:end_date], class: "input" %>
          </div>
          
          <div class="flex gap-2">
            <%= form.submit "Apply Filters", class: "btn btn-secondary" %>
            <%= link_to "Clear", posts_path, class: "btn btn-ghost" %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @posts.any? %>
    <div class="grid gap-4">
      <% @posts.each do |post| %>
        <div class="card">
          <div class="card-header">
            <div class="flex justify-between items-center">
              <div>
                <span class="font-medium"><%= post.user.name %></span>
                <% if post.user.organisation.present? %>
                  <span class="text-sm text-muted-foreground">from <%= post.user.organisation.name %></span>
                <% end %>
              </div>
              <span class="text-xs text-muted-foreground"><%= post.created_at.strftime("%B %d, %Y") %></span>
            </div>
          </div>
          
          <div class="card-content">
            <p><%= post.description %></p>
          </div>
          
          <div class="card-footer">
            <%= link_to "View", post_path(post), class: "btn btn-ghost btn-sm" %>
            <% if current_user && current_user == post.user %>
              <%= link_to "Edit", edit_post_path(post), class: "btn btn-ghost btn-sm" %>
              <%= link_to "Delete", post_path(post), 
                          class: "btn btn-destructive btn-sm", 
                          data: { turbo_method: :delete, turbo_confirm: "Are you sure?" } %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="card">
      <div class="card-content text-center py-10">
        <p class="text-muted-foreground">No posts found. Be the first to create a post!</p>
      </div>
    </div>
  <% end %>

  <% unless logged_in? %>
    <div class="mt-6 text-center">
      <p>
        <%= link_to "Login", login_path, class: "btn btn-ghost" %> or 
        <%= link_to "Sign Up", new_user_path, class: "btn btn-primary" %> to create posts
      </p>
    </div>
  <% end %>
</div>
